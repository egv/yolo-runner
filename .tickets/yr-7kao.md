---
id: yr-7kao
status: open
deps: []
links: []
created: 2026-02-09T22:02:24Z
type: task
priority: 1
assignee: Gennady Evstratov
parent: yr-m4y0
---
# agent: add failure triage note format

Standardize blocked/failure metadata keys written via yolo-task data


## Notes

**2026-02-09T22:22:29Z**

failed_reason=serena initialization failed: INFO  2026-02-09T22:22:28 +1ms service=acp-agent event={"part":{"id":"prt_c447fbfc6001Z3nUlSzVyMnEKu","sessionID":"ses_3bb80759bffeL9il4QwiYR1ZqE","messageID":"msg_c447fb57a001xGm2PtbnGoYr6u","type":"tool","callID":"call_ZMSj17FeDtcLGfXBzSqOGlWP","tool":"grep","state":{"status":"completed","input":{"pattern":"yolo-task data|failure|blocked|triage|note format","path":"."},"output":"Found 100 matches\n/home/egv/dev/yolo-runner/.tickets/yr-7kao.md:\n  Line 12: # agent: add failure triage note format\n  Line 14: Standardize blocked/failure metadata keys written via yolo-task data\n\n/home/egv/dev/yolo-runner/.git/logs/HEAD:\n  Line 42: f368563b8beb75161331cea3295d25bffdf362ce 879bf0a0976584889064e22702606c5374b885d6 Gennady Evstratov <g.evstratov@gmail.com> 1770675499 +0000\tcommit: fix: avoid self-host task replay after review failure\n\n/home/egv/dev/yolo-runner/.git/logs/refs/heads/main:\n  Line 26: f368563b8beb75161331cea3295d25bffdf362ce 879bf0a0976584889064e22702606c5374b885d6 Gennady Evstratov <g.evstratov@gmail.com> 1770675499 +0000\tcommit: fix: avoid self-host task replay after review failure\n\n/home/egv/dev/yolo-runner/README.md:\n  Line 27: - If no code changes were produced, marks the task as `blocked` and exits.\n  Line 157: - **No changes after OpenCode run**: task is marked `blocked`; no commit or close.\n\n/home/egv/dev/yolo-runner/internal/agent/loop.go:\n  Line 144: \t\t\t\t\tif err := l.tasks.SetTaskData(ctx, task.ID, map[string]string{\"blocked_reason\": result.Reason}); err != nil {\n\n/home/egv/dev/yolo-runner/internal/agent/loop_test.go:\n  Line 32: \t\t{Status: contracts.RunnerResultFailed, Reason: \"first failure\"},\n  Line 82: \t\tt.Fatalf(\"expected blocked summary, got %#v\", summary)\n  Line 85: \t\tt.Fatalf(\"expected blocked status, got %s\", mgr.statusByID[\"t-1\"])\n  Line 87: \tif got := mgr.dataByID[\"t-1\"][\"blocked_reason\"]; got != \"needs manual input\" {\n  Line 88: \t\tt.Fatalf(\"expected blocked reason to be saved, got %q\", got)\n\n/home/egv/dev/yolo-runner/internal/tk/task_manager_test.go:\n  Line 15: \terr := m.SetTaskData(context.Background(), \"t-1\", map[string]string{\"blocked_reason\": \"timeout\", \"retry_count\": \"2\"})\n  Line 20: \tif !r.called(\"tk add-note t-1 blocked_reason=timeout\") {\n  Line 21: \t\tt.Fatalf(\"expected blocked_reason note call, got %v\", r.calls)\n  Line 33: \t\t\"tk blocked\": \"\",\n  Line 65: \t\t\"tk blocked\":     \"\",\n\n/home/egv/dev/yolo-runner/MIGRATION.md:\n  Line 17:   - `yolo-task status --id <task> --status <open|in_progress|blocked|closed|failed>`\n  Line 18:   - `yolo-task data --id <task> --set key=value`\n\n/home/egv/dev/yolo-runner/.tickets/yr-ddvt.md:\n  Line 14: Detect hangs, classify timeout/init failures, and kill stuck subprocesses cleanly\n  Line 18: Given stalled agent process, when timeout expires, then runner terminates subprocess and reports blocked/failed with reason\n\n/home/egv/dev/yolo-runner/internal/opencode/runner_adapter_test.go:\n  Line 41: \t\tt.Fatalf(\"expected blocked status, got %s\", result.Status)\n  Line 90: \t\tt.Fatalf(\"expected blocked status, got %s\", result.Status)\n  Line 110: \t\tt.Fatalf(\"expected init failure reason, got %q\", result.Reason)\n\n/home/egv/dev/yolo-runner/cmd/yolo-task/main_test.go:\n  Line 32: \tcode := RunMain([]string{\"status\", \"--id\", \"t-1\", \"--status\", \"blocked\"}, out, errOut, mgr)\n  Line 46: \tcode := RunMain([]string{\"data\", \"--id\", \"t-1\", \"--set\", \"retry_count=2\", \"--set\", \"blocked_reason=timeout\"}, out, errOut, mgr)\n  Line 53: \tif mgr.lastData[\"retry_count\"] != \"2\" || mgr.lastData[\"blocked_reason\"] != \"timeout\" {\n\n/home/egv/dev/yolo-runner/.tickets/yr-lta6.md:\n  Line 14: If review succeeds, merge task branch into main and push main; handle merge/push failures with task status updates\n\n/home/egv/dev/yolo-runner/.tickets/yr-wymf.md:\n  Line 18: Given task outcomes, when loop runs, then statuses transition deterministically through in_progress/completed/blocked/failed\n\n/home/egv/dev/yolo-runner/internal/contracts/contracts.go:\n  Line 15: \tTaskStatusBlocked    TaskStatus = \"blocked\"\n  Line 64: \tRunnerResultBlocked   RunnerResultStatus = \"blocked\"\n\n/home/egv/dev/yolo-runner/.tickets/yr-zuw5.md:\n  Line 18: Given a runner request, when executing, then contract returns normalized completed/blocked/failed result and artifacts paths\n\n/home/egv/dev/yolo-runner/internal/tk/tk.go:\n  Line 46: \tblockedIDs := map[string]struct{}{}\n  Line 47: \tblockedOutput, err := a.runner.Run(\"tk\", \"blocked\")\n  Line 49: \t\tfor _, id := range parseReadyIDs(blockedOutput) {\n  Line 50: \t\t\tblockedIDs[id] = struct{}{}\n  Line 61: \t\tif _, blocked := blockedIDs[id]; blocked {\n  Line 147: \tcase \"blocked\", \"failed\":\n  Line 163: \tif status == \"blocked\" || status == \"failed\" {\n\n/home/egv/dev/yolo-runner/internal/tk/tk_integration_test.go:\n  Line 43: \tif err := a.UpdateStatusWithReason(taskID, \"blocked\", \"runner timeout\"); err != nil {\n\n/home/egv/dev/yolo-runner/internal/tk/tk_test.go:\n  Line 37: \tif err := a.UpdateStatusWithReason(\"root.1\", \"blocked\", \"timeout happened\"); err != nil {\n  Line 41: \tif !r.called(\"tk status root.1 blocked\") {\n  Line 46: \tif !r.called(\"tk add-note root.1 blocked: timeout happened\") {\n\n/home/egv/dev/yolo-runner/FULL_DESCRIPTION.md:\n  Line 11: - set task status (open/closed/in-progress/blocked) by its id\n\n/home/egv/dev/yolo-runner/internal/runner/runner.go:\n  Line 247: \t\tif treeLoaded && isRunnableLeaf(tree) && (tree.Status == \"closed\" || tree.Status == \"blocked\") {\n  Line 342: \t\t\tif err := beadsClient.UpdateStatusWithReason(leafID, \"blocked\", reason); err != nil {\n  Line 343: \t\t\t\tif err := beadsClient.UpdateStatus(leafID, \"blocked\"); err != nil {\n  Line 347: \t\t\treturn \"blocked\", openCodeErr\n  Line 354: \t\t\tif err := beadsClient.UpdateStatusWithReason(leafID, \"blocked\", reason); err != nil {\n  Line 356: \t\t\t\tif err := beadsClient.UpdateStatusWithReason(leafID, \"blocked\", shortReason); err != nil {\n  Line 357: \t\t\t\t\tif err := beadsClient.UpdateStatus(leafID, \"blocked\"); err != nil {\n  Line 362: \t\t\treturn \"blocked\", openCodeErr\n  Line 416: \t\tif err := deps.Logger.AppendRunnerSummary(opts.RepoRoot, leafID, bead.Title, \"blocked\", commitSHA); err != nil {\n  Line 419: \t\tif err := beadsClient.UpdateStatus(leafID, \"blocked\"); err != nil {\n  Line 422: \t\treturn \"blocked\", nil\n  Line 454: \t\tif err := deps.Logger.AppendRunnerSummary(opts.RepoRoot, leafID, bead.Title, \"blocked\", commitSHA); err != nil {\n  Line 457: \t\tif err := beadsClient.UpdateStatus(leafID, \"blocked\"); err != nil {\n  Line 460: \t\treturn \"blocked\", nil\n  Line 501: \t\t\tif result == \"blocked\" {\n  Line 511: \t\tcase \"blocked\":\n\n/home/egv/dev/yolo-runner/internal/opencode/client.go:\n  Line 202: \t// Add timeout mechanism for detecting stuck OpenCode processes and initialization failures\n  Line 212: \t// Monitor for initialization failures\n  Line 216: \t// Check stderr logs for Serena initialization failures\n\n/home/egv/dev/yolo-runner/internal/opencode/timeout_test.go:\n  Line 119: // TestSerenaInitializationFailure tests that Serena language server initialization failures are propagated immediately\n  Line 142: \t// Process exits with non-zero code to indicate failure\n  Line 151: \t// This should fail immediately due to Serena initialization failure\n  Line 155: \t\tt.Fatal(\"expected error due to Serena initialization failure, got nil\")\n  Line 164: // TestSerenaInitializationFailureReturnsImmediately tests that Serena initialization failures\n  Line 200: \t\t\tt.Fatal(\"expected error due to Serena initialization failure, got nil\")\n  Line 206: \t\t\tt.Fatal(\"expected process to be killed on Serena initialization failure\")\n  Line 209: \t\tt.Fatal(\"expected RunWithACP to return immediately on Serena initialization failure\")\n  Line 369: \t// Process exits with non-zero code to indicate failure\n\n/home/egv/dev/yolo-runner/internal/beads/beads_test.go:\n  Line 142: \tif err := adapter.UpdateStatus(\"task-1\", \"blocked\"); err != nil {\n  Line 146: \tassertCall(t, runner.calls, []string{\"bd\", \"update\", \"task-1\", \"--status\", \"blocked\"})\n  Line 153: \tif err := adapter.UpdateStatusWithReason(\"task-1\", \"blocked\", \"no_output last_output_age=10s\"); err != nil {\n  Line 160: \tassertCall(t, runner.calls[:1], []string{\"bd\", \"update\", \"task-1\", \"--status\", \"blocked\"})\n  Line 169: \tif err := adapter.UpdateStatusWithReason(\"task-1\", \"blocked\", reason); err != nil {\n  Line 183: \tif err := adapter.UpdateStatusWithReason(\"task-1\", \"blocked\", long); err != nil {\n  Line 202: \tif err := adapter.UpdateStatusWithReason(\"task-1\", \"blocked\", reason); err != nil {\n\n/home/egv/dev/yolo-runner/internal/opencode/timeout_monitor.go:\n  Line 14: // monitorInitFailures monitors stderr logs for Serena initialization failures\n\n/home/egv/dev/yolo-runner/IMPLEMENTATION_SUMMARY.md:\n  Line 5: The core issue identified was that OpenCode processes get stuck indefinitely when Serena language server fails to initialize. The process can run for 58k+ seconds without any timeout mechanism, and initialization failures are not properly propagated to exit codes.\n  Line 12: 3. Serena initialization failures (like \"language server manager is not initialized\") are not detected early\n  Line 24: - **TestSerenaInitializationFailure**: Tests immediate propagation of Serena initialization failures  \n  Line 37: - Cancels context immediately when initialization failures are detected\n  Line 54: 2. **Serena Error Detection**: Active monitoring of stderr for initialization failures\n  Line 91: âœ… **Propagate Serena initialization failures to exit code immediately** \n\n/home/egv/dev/yolo-runner/internal/runner/acceptance_criteria_test.go:\n  Line 42: \tif err := tracker.UpdateStatusWithReason(\"test-task\", \"blocked\", \"test reason\"); err != nil {\n\n/home/egv/dev/yolo-runner/internal/runner/adapters_test.go:\n  Line 71: \terr = adapter.UpdateStatusWithReason(\"test-1\", \"blocked\", \"test reason\")\n\n/home/egv/dev/yolo-runner/internal/runner/interfaces_test.go:\n  Line 179: \terr = tracker.UpdateStatusWithReason(\"test-1\", \"blocked\", \"test reason\")\n\n/home/egv/dev/yolo-runner/third_party/acp-go/conn.go:\n  Line 227: \t\t\t// Channel might be closed or blocked\n\n/home/egv/dev/yolo-runner/internal/runner/heartbeat_test.go:\n  Line 234: \tif runResult != \"blocked\" {\n  Line 235: \t\tt.Fatalf(\"expected blocked result, got %q\", runResult)\n\n/home/egv/dev/yolo-runner/internal/runner/runner_watchdog_test.go:\n  Line 35: \tif result != \"blocked\" {\n  Line 36: \t\tt.Fatalf(\"expected blocked, got %q\", result)\n  Line 40: \tif !strings.Contains(joined, \"beads.update:blocked:opencode stall category=permission\") {\n  Line 41: \t\tt.Fatalf(\"expected blocked status with reason, got %v\", recorder.calls)\n  Line 85: \tif result != \"blocked\" {\n  Line 86: \t\tt.Fatalf(\"expected blocked, got %q\", result)\n  Line 90: \tif !strings.Contains(joined, \"beads.update:blocked:opencode stall category=no_output\") {\n  Line 91: \t\tt.Fatalf(\"expected fallback blocked update, got %v\", recorder.calls)\n\n(Results are truncated. Consider using a more specific path or pattern.)","title":"yolo-task data|failure|blocked|triage|note format","metadata":{"matches":100,"truncated":true},"time":{"start":1770675748828,"end":1770675748872}},"metadata":{"openai":{"itemId":"fc_07795edb066e3bc801698a5e24c9548191b7585e4e1ee38122"}}}} message part updated
signal: killed

**2026-02-09T22:22:29Z**

terminal_state=failed
